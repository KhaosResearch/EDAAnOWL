@prefix : <https://w3id.org/EDAAnOWL/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix ids: <https://w3id.org/idsa/core/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .

#################################################################
### Shapes for IDSA Classes (DataApp, DataResource)
#################################################################

:DataAppShape a sh:NodeShape ;
    sh:targetClass ids:DataApp ;
    rdfs:label "Data App Shape"@en ;
    
    sh:property [
        sh:path dct:title ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:message "DataApp must have at least one dct:title"@en ;
    ] ;
    
    sh:property [
        sh:path :hasDomainSector ;
        sh:minCount 1 ;
        sh:class skos:Concept ; # Must be a skos:Concept defined in a vocab
        sh:message "DataApp must have at least one :hasDomainSector (which must be a skos:Concept)"@en ;
    ] .

:DataResourceShape a sh:NodeShape ;
    sh:targetClass ids:DataResource ;
    rdfs:label "Data Resource Shape"@en ;

    sh:property [
        sh:path dct:title ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:message "DataResource must have at least one dct:title"@en ;
    ] ;
    
    sh:property [
        sh:path :conformsToProfile ;
        sh:minCount 0 ;
        sh:class :DataProfile ; # Must link to a DataProfile
        sh:message "DataResource must conform to at least one :DataProfile"@en ;
    ] .

#################################################################
### Shapes for EDAAnOWL Classes (DataProfile, Metric)
#################################################################


:DataProfileShape a sh:NodeShape ;
    sh:targetClass :DataProfile ;
    rdfs:label "Data Profile Shape"@en ;
    
    sh:property [
        sh:path dct:title ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:message "DataProfile must have at least one dct:title"@en ;
    ] ;
    sh:property [
        sh:path :declaresDataClass ;
        sh:minCount 1 ;
        sh:nodeKind sh:IRI ;
        sh:message "DataProfile must declare at least one data class (e.g., :tabular, :georaster)"@en ;
    ] ;
    sh:property [
        sh:path :declaresObservedProperty ;
        sh:minCount 1 ;
        sh:class skos:Concept ;
        sh:message "DataProfile must declare at least one observed property (which must be a skos:Concept)"@en ;
    ] .


:MetricValidationShape a sh:NodeShape ;
    sh:targetClass :Metric ;
    sh:property [
        sh:path :metricName ;
        sh:minCount 1 ;
        sh:datatype xsd:string ;
        sh:message "Metric must have a :metricName (string)"@en ;
    ] ;
    sh:property [
        sh:path :metricValue ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ; 
        sh:message "Metric must have a numeric :metricValue"@en ;
    ] .

#################################################################
#    Shapes for v0.1.0 (Direct Semantic Model)
#################################################################

:DataAssetShape
    a sh:NodeShape ;
    sh:targetClass :DataAsset ;
    sh:property [
        sh:path :servesObservableProperty ;
        sh:minCount 1 ;
        sh:class skos:Concept ;
        sh:message "A :DataAsset must serve at least one :ObservableProperty (which must be a skos:Concept)"@en
    ] .

:SpatialTemporalAssetShape
    a sh:NodeShape ;
    sh:targetClass :SpatialTemporalAsset ;
    # Note: inherits the rule from :DataAssetShape (sh:minCount 1 :servesObservableProperty)
    sh:property [
        sh:path :hasSpatialCoverage ;
        sh:minCount 1 ;
        sh:nodeKind sh:BlankNode ;
        sh:message "A :SpatialTemporalAsset must have at least one :hasSpatialCoverage"@en
    ] ;
    sh:property [
        sh:path :hasTemporalCoverage ;
        sh:minCount 1 ;
        sh:nodeKind sh:BlankNode ;
        sh:message "A :SpatialTemporalAsset must have at least one :hasTemporalCoverage"@en
    ] .

:AnalyticalServiceShape
    a sh:NodeShape ;
    sh:targetClass :AnalyticalService ;
    sh:or (
        [ 
            sh:path :requiresObservableProperty ; 
            sh:minCount 1 ;
            sh:class skos:Concept
        ]
        [ 
            sh:path :producesObservableProperty ; 
            sh:minCount 1 ;
            sh:class skos:Concept #
        ]
    ) ;
    sh:message "An :AnalyticalService must either require or produce at least one :ObservableProperty (which must be a skos:Concept)"@en .